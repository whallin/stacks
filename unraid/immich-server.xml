<?xml version="1.0"?>
<Container version="2">
    <!-- IMAGE -->
    <Name>immich-server</Name>
    <Repository>ghcr.io/immich-app/immich-server:release</Repository>
    <Registry>https://github.com/immich-app/immich/pkgs/container/immich-server</Registry>

    <!-- CONTAINER SETTINGS -->
    <Network>bridge</Network> <!-- host or bridge -->
    <Shell>sh</Shell>
    <Privileged>false</Privileged>

    <!-- TEMPLATE INFORMATION -->
    <Support>https://github.com/immich-app/immich/issues</Support>
    <Project>https://github.com/immich-app/immich</Project>
    <ReadMe>https://immich.app/docs/overview/quick-start</ReadMe>
    <Overview>High performance self-hosted photo and video management solution.</Overview>
    <Category>MediaApp:Video MediaApp:Photos MediaServer:Video MediaServer:Photos</Category>
    <WebUI>http://[IP]:[PORT:2283]/</WebUI>
    <TemplateURL>https://raw.githubusercontent.com/whallin/stacks/develop/unraid/immich-server.xml</TemplateURL>
    <Icon>https://cdn.jsdelivr.net/gh/selfhst/icons/png/immich.png</Icon>

    <!-- CONTAINER FLAGS -->
    <ExtraParams>--init --no-healthcheck --restart=unless-stopped</ExtraParams>
    <PostArgs>POST_ARGS</PostArgs>

    <!-- ADDITIONAL REQUIREMENTS -->
    <Requires>Immich requires:&#xD;
        - A PostgreSQL database with VectorChord&#xD;
        - A Redis-compatibile database&#xD;
        - A Immich Machine Learning container</Requires>

    <!-- MOUNTED PATHS -->
    <Config Name="Upload Location" Target="/usr/src/app/upload"
        Default="/mnt/user/appdata/immich/uploads" Mode="rw"
        Description="Upload location for Immich" Type="Path" Display="always" Required="true"
        Mask="false">
        /mnt/user/appdata/immich/uploads</Config>
    <Config Name="Local Time" Target="/etc/localtime" Default="/etc/localtime" Mode="ro"
        Description="Container's local time from host" Type="Path" Display="advanced"
        Required="false" Mask="false">/etc/localtime</Config>

    <!-- PORT MAPPINGS -->
    <Config Name="Web UI Port" Target="2283" Default="2283" Mode="tcp"
        Description="Web UI port for Immich" Type="Port"
        Display="always" Required="true" Mask="false">2283</Config>

    <!-- ENVIRONMENT VARIABLES -->
    <Config Name="DB_URL" Target="DB_URL"
        Default="postgresql://user:password@host:port/db_name" Mode=""
        Description="Database connection URL"
        Type="Variable" Display="always" Required="true" Mask="false">postgresql://</Config>
    <Config Name="REDIS_HOSTNAME" Target="REDIS_HOSTNAME" Default="redis" Mode=""
        Description="Hostname of the Redis server"
        Type="Variable" Display="always" Required="true" Mask="false">redis</Config>
    <Config Name="REDIS_PORT" Target="REDIS_PORT" Default="6379" Mode=""
        Description="Port of the Redis server"
        Type="Variable" Display="always" Required="true" Mask="false">6379</Config>
    <Config Name="REDIS_USERNAME" Target="REDIS_USERNAME" Default="redis" Mode=""
        Description="Username for the Redis server"
        Type="Variable" Display="always" Required="false" Mask="false">redis</Config>
    <Config Name="REDIS_PASSWORD" Target="REDIS_PASSWORD" Default="" Mode=""
        Description="Password for the Redis server"
        Type="Variable" Display="always" Required="false" Mask="true"></Config>
    <Config Name="REDIS_DBINDEX" Target="REDIS_DBINDEX" Default="0" Mode=""
        Description="Database index for the Redis server"
        Type="Variable" Display="always" Required="true" Mask="false">0</Config>

    <!-- DEVICE MAPPINGS -->
    <Config Name="QuickSync and VAAPI Device" Target="/dev/dri" Default="" Mode=""
        Description="QuickSync and VAAPI device for hardware accelerated transcoding"
        Type="Device"
        Display="advanced" Required="false" Mask="false">/dev/dri</Config>
</Container>